{"version":3,"file":"google-guards.js","sourceRoot":"/","sources":["src/auth/strategies/google-guards.ts"],"names":[],"mappings":";;;;;;;;;;;;AACA,2CAA8D;AAC9D,2CAA+C;AAC/C,+CAA6C;AAItC,IAAM,eAAe,GAArB,MAAM,eAAgB,SAAQ,IAAA,oBAAS,EAAC,QAAQ,CAAC;IACtD,YAAoB,aAA2C;QAC7D,KAAK,EAAE,CAAC;QADU,kBAAa,GAAb,aAAa,CAA8B;IAE/D,CAAC;IAED,KAAK,CAAC,WAAW,CAAC,OAAyB;QACzC,MAAM,OAAO,GAAG,OAAO,CAAC,YAAY,EAAE,CAAC,UAAU,EAAE,CAAC;QACpD,MAAM,QAAQ,GAAG,OAAO,CAAC,YAAY,EAAE,CAAC,WAAW,EAAE,CAAC;QAEtD,IAAI,CAAC;YACH,MAAM,QAAQ,GAAG,CAAC,MAAM,KAAK,CAAC,WAAW,CAAC,OAAO,CAAC,CAAY,CAAC;YAC/D,IAAI,QAAQ;gBAAE,MAAM,KAAK,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;YACzC,OAAO,QAAQ,CAAC;QAClB,CAAC;QAAC,OAAO,GAAG,EAAE,CAAC;YACb,MAAM,cAAc,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAC3C,oBAAoB,EACpB;gBACE,KAAK,EAAE,IAAI;aACZ,CACF,CAAC;YACF,QAAQ,CAAC,QAAQ,CAAC,GAAG,cAAc,yBAAyB,CAAC,CAAC;YAC9D,OAAO,KAAK,CAAC;QACf,CAAC;IACH,CAAC;CACF,CAAA;AAxBY,0CAAe;0BAAf,eAAe;IAD3B,IAAA,mBAAU,GAAE;qCAEwB,sBAAa;GADrC,eAAe,CAwB3B","sourcesContent":["/* eslint-disable prettier/prettier */\r\nimport { ExecutionContext, Injectable } from '@nestjs/common';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { AuthGuard } from '@nestjs/passport';\r\nimport { AllConfigType } from 'src/config/config.type';\r\n\r\n@Injectable()\r\nexport class GoogleAuthGuard extends AuthGuard('google') {\r\n  constructor(private configService: ConfigService<AllConfigType>) {\r\n    super();\r\n  }\r\n\r\n  async canActivate(context: ExecutionContext) {\r\n    const request = context.switchToHttp().getRequest();\r\n    const response = context.switchToHttp().getResponse();\r\n\r\n    try {\r\n      const activate = (await super.canActivate(context)) as boolean;\r\n      if (activate) await super.logIn(request);\r\n      return activate;\r\n    } catch (err) {\r\n      const frontendDomain = this.configService.get<string>(\r\n        'app.frontendDomain',\r\n        {\r\n          infer: true,\r\n        },\r\n      );\r\n      response.redirect(`${frontendDomain}/account/sign-in?r_id=0`);\r\n      return false;\r\n    }\r\n  }\r\n}\r\n"]}