{"version":3,"file":"myWallet.service.js","sourceRoot":"/","sources":["src/my-wallet/myWallet.service.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable prettier/prettier */\r\nimport { Injectable, HttpException, HttpStatus } from '@nestjs/common';\r\nimport { Repository } from 'typeorm';\r\nimport { InjectRepository } from '@nestjs/typeorm';\r\nimport { User, UserPermission } from '@app/typeorm/entities/user.entity';\r\nimport { CreateWalletDto, UpdateWalletDto } from './dto/myWalletDto';\r\nimport { IWalletService } from './myWallet';\r\nimport { MyWallet } from '@app/typeorm/entities/wallet.entity';\r\n\r\n@Injectable()\r\nexport class WalletService implements IWalletService {\r\n  constructor(\r\n    @InjectRepository(User)\r\n    private readonly usersRepository: Repository<User>,\r\n    @InjectRepository(MyWallet)\r\n    private readonly walletRepository: Repository<MyWallet>,\r\n  ) {}\r\n\r\n  async createWallet(\r\n    id: number,\r\n    createWalletDto: CreateWalletDto,\r\n  ): Promise<MyWallet> {\r\n    const existingUser = await this.usersRepository.findOne({\r\n      where: { id },\r\n    });\r\n\r\n    if (!existingUser)\r\n      throw new HttpException(\"User doesn't exists\", HttpStatus.CONFLICT);\r\n\r\n    if (existingUser.permission !== UserPermission.Admin)\r\n      throw new HttpException(\r\n        'User is not permitted to take this action',\r\n        HttpStatus.CONFLICT,\r\n      );\r\n\r\n    const wallet = this.walletRepository.create({\r\n      ...createWalletDto\r\n    });\r\n\r\n    return await this.walletRepository.save(wallet);\r\n  }\r\n\r\n  async getWallet(name: string): Promise<MyWallet> {\r\n    return await this.walletRepository.findOne({\r\n      where: { name },\r\n    });\r\n  }\r\n\r\n  async getAllWallet(): Promise<MyWallet[]> {\r\n    return await this.walletRepository.find();\r\n  }\r\n\r\n  async updateWallet(id: number, details: UpdateWalletDto): Promise<MyWallet> {\r\n    const { id: userId, ...values } = details;\r\n    const user = await this.usersRepository.findOne({\r\n      where: { id },\r\n    });\r\n\r\n    if (user.permission !== UserPermission.Admin)\r\n      throw new HttpException(\r\n        'User is not permitted to take this action',\r\n        HttpStatus.CONFLICT,\r\n      );\r\n\r\n    const wallet = await this.walletRepository.findOne({\r\n      where: { id: userId },\r\n    });\r\n\r\n    if (!wallet)\r\n      throw new HttpException(\"Wallet doesn't exists\", HttpStatus.CONFLICT);\r\n\r\n    const updateWallet = { ...wallet, ...values };\r\n\r\n    return await this.walletRepository.save(updateWallet);\r\n  }\r\n\r\n  async deleteWallet(\r\n    userId: number,\r\n    id: number,\r\n  ): Promise<{ id: number; deleted: boolean }> {\r\n    try {\r\n      const user = await this.usersRepository.findOne({\r\n        where: { id: userId },\r\n      });\r\n\r\n      if (user.permission !== UserPermission.Admin)\r\n        throw new HttpException(\r\n          'User is not permitted to take this action',\r\n          HttpStatus.CONFLICT,\r\n        );\r\n\r\n      const wallet = await this.walletRepository.findOne({\r\n        where: { id },\r\n      });\r\n\r\n      if (!wallet)\r\n        throw new HttpException(\"Wallet doesn't exists\", HttpStatus.CONFLICT);\r\n\r\n      await this.walletRepository.softDelete(id);\r\n\r\n      return { id, deleted: true };\r\n    } catch {\r\n      return { id, deleted: false };\r\n    }\r\n  }\r\n}\r\n"]}